<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" /><title>Jeu AAA nathan</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    </script>
    <style type="text/css"> body 
        { margin: 0; 
        }
    </style>
</head>
<body>
    <script type="text/javascript">

        class accueil extends Phaser.Scene{
            constructor(){
            super("accueil");
        }

        preload(){}
        create(){}
        update(){
            this.scene.start("sceneJeu", {
                pointDeVie:4,
                sabreInterface:false,
                dialogue:false,
                trancherActif:false,
                pouvoirAttaquer:false,
                animVehicule:false,
                quitterVheicule:false,
                invulnérable:false,
                tempsAvantRespawn:false,
                porteOuverte:false,
                entreeBatiment:false,
                carteMagnetiqueInterface: false,
                solde:0,
                reacteur1Pris:false,
                reacteur2Pris:false,
                reacteursBackgroundInterface:false
            })
        }

    }

        class sceneJeu extends Phaser.Scene{
            constructor(){
            super("sceneJeu");
        }

        init(data){
            this.pointDeVie = data.pointDeVie,
            this.sabreInterface = data.sabreInterface,
            this.dialogue = data.dialogue,
            this.trancherActif = data.trancherActif,
            this.pouvoirAttaquer = data.pouvoirAttaquer,
            this.animVehicule = data.animVehicule,
            this.quitterVheicule = data.quitterVheicule,
            this.invulnérable = data.invulnérable,
            this.tempsAvantRespawn = data.tempsAvantRespawn,
            this.porteOuverte = data.porteOuverte,
            this.entreeBatiment = data.entreeBatiment,
            this.spawnXSortieScene = data.spawnXSortieScene,
            this.spawnYSortieScene = data.spawnYSortieScene,
            this.carteMagnetiqueInterface = data.carteMagnetiqueInterface,
            this.solde = data.solde,
            this.reacteur1Pris = data.reacteur1Pris,
            this.reacteur2Pris = data.reacteur2Pris,
            this.reacteursBackgroundInterface = data.reacteursBackgroundInterface
        }

        preload(){
            this.load.image("Phaser_tuilesdejeu", "assets/tuilesJeu.png");

            this.load.tilemapTiledJSON("carte", "map.json");  

            this.load.spritesheet('perso','assets/perso.png',
            { frameWidth: 32, frameHeight: 32 });
            this.load.spritesheet('persoMort','assets/persoMort.png',
            { frameWidth: 32, frameHeight: 32 });
            this.load.spritesheet('animAttaque','assets/animAttaque.png',
            { frameWidth: 32, frameHeight: 48 });

            this.load.spritesheet('ennemi','assets/ennemi.png',
            { frameWidth: 31, frameHeight: 20 });

            // sprite vehicule
            this.load.spritesheet('vehiculeBackFront','assets/vehiculeBackFront.png',
            { frameWidth: 80, frameHeight: 96 });
            this.load.spritesheet('vehiculeRightLeft','assets/vehiculeRightLeft.png',
            { frameWidth: 160, frameHeight: 96 });

            this.load.image("pnj1", "assets/PNJ1.png");
            this.load.image("sabre", "assets/objets/sabre.png");

            //sabre interface
            this.load.image("sabreInterface", "assets/interface/sabreInterface.png");

            // carte magnétique interface
            this.load.image("carteMagnetiqueInterface", "assets/interface/carteMagnetiqueInterface.png");

            // hitbox perso différente de celle avec laquelle il est en collision avec les builds
            this.load.image("hitbox", "assets/objets/emplacementChangementDeScene/changementScene.png");

            this.load.image("porteEntreeGrotteFermée", "assets/objets/porteEntreeGrotteFermée.png");
            this.load.image("porteEntreeGrotteOuvert", "assets/objets/porteEntreeGrotteOuvert.png");

            this.load.image("coeur", "assets/objets/coeur.png");

            // coffre essence
            this.load.image('coffre', 'assets/objets/coffre.png');
            this.load.spritesheet('coffreAnim1','assets/objets/coffreAnim.png',
            { frameWidth: 48, frameHeight: 32 });

            // coffre HP
            this.load.image('coffreHp', 'assets/objets/coffreHp.png');
            this.load.spritesheet('coffreHpAnim1','assets/objets/coffreHpAnim.png',
            { frameWidth: 48, frameHeight: 32 });

            // emplacement Changement De Scene
            this.load.image("changementScene", "assets/objets/emplacementChangementDeScene/changementScene.png");

            //emplacement invisible pour ouvrir le coffre ou autre
            this.load.image("ouvrirCoffre", "assets/objets/emplacementChangementDeScene/changementScene.png");
            //emplacement invisible pour ouvrir le coffre HP ou autre
            this.load.image("ouvrirCoffreHp", "assets/objets/emplacementChangementDeScene/changementScene.png");


            this.load.image("monnaie", "assets/objets/monnaie.png");
            this.load.image("monnaieInterface", "assets/interface/monnaieInterface.png");

            // frame barre de vie
            this.load.image("4HP", "assets/interface/vie/coeurInterface4HP.png");
            this.load.image("3HP", "assets/interface/vie/coeurInterface3HP.png");
            this.load.image("2HP", "assets/interface/vie/coeurInterface2HP.png");
            this.load.image("1HP", "assets/interface/vie/coeurInterface1HP.png");
            this.load.image("0HP", "assets/interface/vie/coeurInterface0HP.png");

            // reacteurs
            this.load.image("0HP", "assets/interface/vie/coeurInterface0HP.png");

            // textes PNJ
            this.load.image("TexteIntro1", "assets/interface/texte/TexteIntro 1.png");
            this.load.image("TexteIntro2", "assets/interface/texte/TexteIntro 2.png");

            // reacteurs
            this.load.image("réacteur1", "assets/objets/réacteur1.png");
            this.load.image("réacteur2", "assets/objets/réacteur2.png");
            this.load.image("reacteursInterfaces", "assets/interface/reacteursInterfaces.png");

            // drop du coffre
            this.load.image("bidonEssence", "assets/objets/bidonEssence.png");
            this.load.image("bidonEssenceInterface", "assets/interface/bidonEssenceInterface.png");
        }

        


        create(){
            const carte = this.make.tilemap({ key: 'carte' });

            // importer les TileSet 
            const tileset = carte.addTilesetImage(
                    "tuilesJeu",
                    "Phaser_tuilesdejeu"
                    );  

            const ground = carte.createLayer(
                    "ground",
                    tileset
                    );

            const build = carte.createLayer(
                    "build",
                    tileset
                    );

            const collisionInvisible = carte.createLayer(
                    "collisionInvisible",
                    tileset
                    );
   
            const decor = carte.createLayer(
                    "decor",
                    tileset
                    );

            this.entreeGrotte = this.physics.add.image(430, 100, 'changementScene');
            this.entreeGrotte.body.setSize(150,80,true)

            this.entreeMaisonBlanche = this.physics.add.image(530,200, 'changementScene');
            this.entreeMaisonBlanche.body.setSize(90,40,true)
            this.entreeMaisonBlanche.setOffset(-31,100)

            this.entreeMaison1 = this.physics.add.image(540,415, 'changementScene');
            this.entreeMaison1.body.setSize(90,40,true)

            ///////////////////////////////////////////////////////////////
            ///////////////////////////////////////////////////////////////
            ///////////////////////////////////////////////////////////////

            if (this.entreeBatiment == true){
                this.player = this.physics.add.sprite(this.spawnXSortieScene, this.spawnYSortieScene, 'perso').setOrigin(0);
            }

            else{
                carte.getObjectLayer('spawnJoueur').objects.forEach((spawnJoueur) => {
                this.player = this.physics.add.sprite(spawnJoueur.x, spawnJoueur.y, 'perso').setOrigin(0);
            });
            }

            this.playerCollision2 = this.physics.add.image(50,50,"hitbox")
            this.playerCollision2.body.setSize(32,22)
            this.playerCollision2.setOffset(16,26)
            
            this.player.body.setSize(24,6,true)
            this.player.setOffset(4, 26)

            this.player.setDepth(7)

            this.vehicule = this.physics.add.sprite(200,500,'vehiculeRightLeft') 
            this.vehicule.body.setSize(200,120,true)

            this.vehicule.setDepth(8)

            const persoDerriere = carte.createLayer(
                    "persoDerriere",
                    tileset
                    );
            persoDerriere.setDepth(9)

            this.compteurAttaqueTemps = 60
            this.compteurInvunlerable = 150
            this.compteurTempsAvantRespawn = 300
            this.compteurAnimCoffre = 30
            this.compteurDropCoffre = 150;
            this.entrerActif = true
            this.entreeBatiment = false
            this.coffreAnimStop = false
            this.dropCoffreActif = false
            this.dropCoffreInterface = false

            this.physics.add.collider(this.player, build);
            this.physics.add.collider(this.vehicule, build);
            build.setCollisionByProperty({ estSolide: true });

            this.physics.add.collider(this.player, collisionInvisible);
            collisionInvisible.setCollisionByProperty({ estSolide: true });

            // fonction pour entre la grotte
            this.physics.add.overlap(this.player, this.entreeGrotte, this.goInsideGrotto, null, this)

            // fonction pour entre la maison blanche
            this.physics.add.overlap(this.player, this.entreeMaisonBlanche, this.goInsideWhiteHouse, null, this)

            // fonction pour entre la 1e maison
            this.physics.add.overlap(this.player, this.entreeMaison1, this.goInside1stHouse, null, this)

            this.physics.add.collider(this.player, decor);
            decor.setCollisionByProperty({ estSolide: true });

            this.player.setCollideWorldBounds(true);
            this.vehicule.setCollideWorldBounds(true);

            this.cameras.main.zoom = 3
            this.cameras.main.startFollow(this.player); 
            this.physics.world.setBounds(0, 0, 6400, 6400);
            this.cameras.main.setBounds(0, 0, 6400, 6400);

            this.anims.create({
                key: 'left',
                frames: this.anims.generateFrameNumbers('perso', {start:18,end:23}),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'right',
                frames: this.anims.generateFrameNumbers('perso', {start:12,end:17}),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'front',
                frames: this.anims.generateFrameNumbers('perso', {start:0,end:5}),
                frameRate: 8,
                repeat: -1
            });

            this.anims.create({
                key: 'back',
                frames: this.anims.generateFrameNumbers('perso', {start:6,end:11}),
                frameRate: 8,
                repeat: -1
            });

            this.anims.create({
                key: 'noMove',
                frames: this.anims.generateFrameNumbers('perso', {start:24,end:31}),
                frameRate: 8,
                repeat: -1
            });

            // animation de mort
            this.anims.create({
                key: 'persoMort',
                frames: this.anims.generateFrameNumbers('persoMort', {start:0,end:3}),
                frameRate: 5,
            });
            
            // animations lorsque le joueur à le sabre en main
            this.anims.create({
                key: 'leftSaber',
                frames: this.anims.generateFrameNumbers('animAttaque', {start:15,end:19}),
                frameRate: 12,
                repeat: -1
            });
            this.anims.create({
                key: 'rightSaber',
                frames: this.anims.generateFrameNumbers('animAttaque', {start:10,end:14}),
                frameRate: 12,
                repeat: -1
            });
            this.anims.create({
                key: 'frontSaber',
                frames: this.anims.generateFrameNumbers('animAttaque', {start:0,end:4}),
                frameRate: 12,
                repeat: -1
            });

            this.anims.create({
                key: 'backSaber',
                frames: this.anims.generateFrameNumbers('animAttaque', {start:5,end:9}),
                frameRate: 12,
                repeat: -1
            });

            this.anims.create({
                key: 'noMoveSaber',
                frames: this.anims.generateFrameNumbers('animAttaque', {start:20,end:24}),
                frameRate: 12,
                repeat: -1
            });
            
            // animation vehicule
            this.anims.create({
                key: 'animVehiculeBack',
                frames: this.anims.generateFrameNumbers('vehiculeBackFront', {start:0,end:3}),
                frameRate: 12,
                repeat: -1
            });
            this.anims.create({
                key: 'animVehiculeFront',
                frames: this.anims.generateFrameNumbers('vehiculeBackFront', {start:4,end:7}),
                frameRate: 12,
                repeat: -1
            });
            this.anims.create({
                key: 'animVehiculeRight',
                frames: this.anims.generateFrameNumbers('vehiculeRightLeft', {start:0,end:4}),
                frameRate: 12,
                repeat: -1
            });
            this.anims.create({
                key: 'animVehiculeLeft',
                frames: this.anims.generateFrameNumbers('vehiculeRightLeft', {start:5,end:9}),
                frameRate: 12,
                repeat: -1
            });
            this.anims.create({
                key: 'animVehiculeNoMove',
                frames: this.anims.generateFrameNumbers('vehiculeRightLeft', {start:10,end:13}),
                frameRate: 12,
                repeat: -1
            });

            // pour que mon vehicule ne fasse plus rien une fois arrêté
            this.anims.create({
                key: 'animVehiculeStop',
                frames: this.anims.generateFrameNumbers('vehiculeRightLeft', {start:0,end:0}),
                frameRate: 12,
                repeat: -1
            });

            // animation ennemis
            this.anims.create({
                key: 'frontEnnemis',
                frames: this.anims.generateFrameNumbers('ennemi', {start:0,end:5}),
                frameRate: 12,
                repeat: -1
            });
            this.anims.create({
                key: 'backEnnemis',
                frames: this.anims.generateFrameNumbers('ennemi', {start:6,end:11}),
                frameRate: 12,
                repeat: -1
            });

            // animation d'ouverture du coffre
            this.anims.create({
                key: 'coffreAnim',
                frames: this.anims.generateFrameNumbers('coffreAnim1', {start:0,end:1}),
                frameRate: 5,
                repeat: -1
            });

            // apparition de la fonction qui permet au joueur de rentrer dans le véhicule
            this.physics.add.overlap(this.player, this.vehicule, this.entrerVehicule, null,this);

            // coeur à récupérer
            this.coeur = this.physics.add.group({
            });
                    
            carte.getObjectLayer('coeur').objects.forEach((coeur) => {
            this.coeur.create(coeur.x, coeur.y, 'coeur').setOrigin(0);
            });

            this.physics.add.overlap( this.playerCollision2, this.coeur,  this.prendreHp, null,this);

            // monnaie à récupérer
            this.monnaie = this.physics.add.group({
            });
                    
            carte.getObjectLayer('monnaie').objects.forEach((monnaie) => {
            this.monnaie.create(monnaie.x, monnaie.y, 'monnaie').setScale(0.6).setOrigin(0);
            });

            this.physics.add.overlap( this.playerCollision2, this.monnaie,  this.prendreMonnaie, null,this);

            // porte fermée à l'entrée de la grotte
            if (this.porteOuverte == false){
                this.porteGrotte = this.physics.add.image(176, 256,'porteEntreeGrotteFermée')
                this.porteGrotte.body.setSize(96,32,true)
                this.porteGrotte.setOffset(2,32,true)
            }

            if (this.porteOuverte == true){
                this.porteGrotte = this.physics.add.image(176, 256,'porteEntreeGrotteOuvert')
                this.porteGrotte.body.setSize(48,32,true)
                this.porteGrotte.setOffset(2,32,true)
            }

                this.porteGrotte.setInteractive()

                this.porteGrotte.setDepth(1)
                this.porteGrotte.setPushable(false)
                this.physics.add.collider(this.player,this.porteGrotte)

                // interaction avec la porte afin de l'ouvrir
                this.porteGrotteOverlap = this.physics.add.image(180,270, 'changementScene');
                this.porteGrotteOverlap.body.setSize(40,34,true)
                this.porteGrotteOverlap.setOffset(-31,20)

                this.physics.add.overlap( this.player, this.porteGrotteOverlap,  this.ouvrirPorteGrotte, null,this);

                // apparition des ennemis
                this.enemis = this.physics.add.group({
                });
                        
                carte.getObjectLayer('spawnEnnemi').objects.forEach((enemis) => {
                this.enemi = this.enemis.create(enemis.x, enemis.y, 'ennemi').setOrigin(0);
                this.enemi.setBounce(1);
                });

                this.enemis.setVelocityY(-50)
                this.ennemiDirection = 1

                this.physics.add.overlap( this.player, this.enemis,  this.toucherEnnemi, null,this);

                this.physics.add.collider(this.enemis,build,);

            ////////////////////////////////////////////////////////////
            // placement du coffre Essence
            ////////////////////////////////////////////////////////////
            this.coffre = this.physics.add.image(500, 500,'coffre')
            //placer collision coffre Essence
            this.ouvrirCoffre1 = this.physics.add.image(this.coffre.x, this.coffre.y,'ouvrirCoffre')
            this.ouvrirCoffre1.setPushable(false)
            this.physics.add.collider(this.player,this.ouvrirCoffre1)

            this.coffre.body.setSize(60,60)

            this.physics.add.overlap( this.player, this.coffre, this.ouvrirCoffre, null,this);







            ////////////////////////////////////////////////////////////
            // placement du coffre Hp
            ////////////////////////////////////////////////////////////

            this.coffreHp = this.physics.add.group({
            });
                    
            carte.getObjectLayer('coffreHp').objects.forEach((coffreHp) => {
            this.coffreHp.create(coffreHp.x, coffreHp.y, 'coffreHp').setOrigin(0);
            });

            this.ouvrirCoffreHp = this.physics.add.group({
            });
                    
            carte.getObjectLayer('ouvrirCoffreHp').objects.forEach((ouvrirCoffreHp) => {
            this.ouvrirCoffreHp.create(ouvrirCoffreHp.x, ouvrirCoffreHp.y, 'ouvrirCoffreHp').setOrigin(0);
            });


            















            // réacteurs 2 à récupérer        
            carte.getObjectLayer('reacteurs2').objects.forEach((reacteurs2) => {
            this.reacteurs2 = this.physics.add.image(reacteurs2.x, reacteurs2.y, 'réacteur2').setScale(0.6).setOrigin(0);
            });

            this.physics.add.overlap( this.playerCollision2, this.reacteurs2, this.prendreReacteur2, null,this);

                

            ///////////////////////////////////////////////////////////////
            /////////////////////////INTERFACE/////////////////////////////
            ///////////////////////////////////////////////////////////////

            //vie interface
            this.coeurEcran = this.add.image(306, 161,'4HP').setScale(0.7)
            this.coeurEcran.setInteractive()
            this.coeurEcran.setScrollFactor(0);  

            this.coeurEcran.setDepth(10)

            // monnaie interface
            this.monnaieEcran = this.add.image(275, 185,'monnaieInterface').setScale(0.5);
            this.monnaieEcran.setDepth(100)
            this.monnaieEcran.setScrollFactor(0);  
            this.monnaieTexte = this.add.text(288, 174,this.solde, {
                font: '30px Poppins semibold',
                fill: "#0022BD" 
            });
            this.monnaieTexte.setDepth(100)
            this.monnaieTexte.setScale(0.7);
            this.monnaieTexte.setScrollFactor(0);

            ///////////////////////////////////////////////////////////////
            //////////////////////////////PNJ//////////////////////////////
            ///////////////////////////////////////////////////////////////

            this.pnj1 = this.physics.add.image(240, 380, 'pnj1');
            this.pnj1.setPushable(false)
            this.pnj1.body.setSize(48,64)
            this.pnj1.setOffset(-8,0)
            this.physics.add.overlap(this.player,this.pnj1,this.parlerPNJ1,null,this);

            ///////////////////////////////////////////////////////////////
            /////////////////////////TOUCHES///////////////////////////////
            ///////////////////////////////////////////////////////////////

            this.cursors = this.input.keyboard.createCursorKeys();
            this.keys = this.input.keyboard.addKeys({
                q:  this.input.keyboard.addKey('Q'),
                d:  this.input.keyboard.addKey('D'),
                z:  this.input.keyboard.addKey('Z'),
                s:  this.input.keyboard.addKey('S'),
            });

            this.toucheF = this.input.keyboard.addKey('F');
            this.toucheG = this.input.keyboard.addKey('G');
            this.trancher = this.input.keyboard.addKey('A');
        }

        update(){
            this.playerCollision2.x = this.player.x
            this.playerCollision2.y = this.player.y

            if (this.dialogue ==false){

                this.moveUp = ( this.cursors.up.isDown || this.keys.z.isDown )  
                this.moveLeft = ( this.cursors.left.isDown || this.keys.q.isDown )  
                this.moveRight = ( this.cursors.right.isDown || this.keys.d.isDown ) 
                this.moveDown = ( this.cursors.down.isDown || this.keys.s.isDown ) 
                

                const speed = 400

                    if (this.moveLeft) {
                        this.player.setVelocityX(-speed)
                        this.player.direction = 'left';
                    } else if (this.moveRight) {
                        this.player.setVelocityX(speed)
                        this.player.direction = 'right';
                    }

                    if (this.moveUp) {
                        this.player.setVelocityY(-speed)
                        this.player.direction = 'up';
                    } else if (this.moveDown) {
                        this.player.setVelocityY(speed)
                        this.player.direction = 'down';
                    }

                    this.player.body.velocity.normalize().scale(speed)

                if (this.trancherActif == false){
                    if (this.moveUp) {
                        this.player.anims.play('back', true)
                    } else if (this.moveDown) {
                        this.player.anims.play('front', true)
                    } else
                    if (this.moveLeft) {
                        this.player.anims.play('left', true)
                    } else if (this.moveRight) {
                        this.player.anims.play('right', true)
                    }   

                    if (this.cursors.up.isUp && this.cursors.down.isUp && this.cursors.left.isUp && this.cursors.right.isUp){
                        this.player.anims.play('noMove', true);
                        this.player.direction = 'none';
                        this.player.setVelocityX(0)
                        this.player.setVelocityY(0)
                    }
                    this.physics.add.overlap(this.player, this.enemis, this.perdPvEnnemi, null,this);
                }
                if (this.trancherActif == true){
                    if (this.moveUp) {
                        this.player.anims.play('backSaber', true)
                    } else if (this.moveDown) {
                        this.player.anims.play('frontSaber', true)
                    } else
                    if (this.moveLeft) {
                        this.player.anims.play('leftSaber', true)
                    } else if (this.moveRight) {
                        this.player.anims.play('rightSaber', true)
                    }   

                    if (this.cursors.up.isUp && this.cursors.down.isUp && this.cursors.left.isUp && this.cursors.right.isUp){
                        this.player.anims.play('noMoveSaber', true);
                        this.player.direction = 'none';
                        this.player.setVelocityX(0)
                        this.player.setVelocityY(0)
                    }
                }
            }

            if( this.pouvoirAttaquer == true){
                if (Phaser.Input.Keyboard.JustDown(this.trancher)) {   
                    this.trancherActif = true
                    this.tempsAttaque = true
                    if (this.player.direction == 'down'){
                        this.player.setSize(32,32,true)
                        this.player.setOffset(0, 15)
                    }
                    if (this.player.direction == 'up'){
                        this.player.setSize(32,30,true)
                        this.player.setOffset(0, 2)
                    }
                    if (this.player.direction == 'left'){
                        this.player.setSize(16,28,true)
                        this.player.setOffset(0, 12)
                    }
                    if (this.player.direction == 'right'){
                        this.player.setSize(16,28,true)
                        this.player.setOffset(18, 12)
                    }
                    if (this.player.direction == 'none'){
                        this.player.setSize(32,30,true)
                        this.player.setOffset(0, 17)
                    }
                }
            }

            if ( this.tempsAttaque == false) {   
                this.trancherActif = false
                this.player.setSize(24,6,true)
                this.player.setOffset(4, 26)
            }

            if(this.tempsAttaque == true){
                this.compteurAttaqueTemps -=1 ;
                if(this.compteurAttaqueTemps == 0){
                    this.compteurAttaqueTemps = 60;
                    this.tempsAttaque = false ;
                }
            }

            // deplacement vehicule
            if (this.animVehicule == true){
                if (this.moveLeft) {
                    this.vehicule.setSize(180,70,true)
                    this.vehicule.setOffset(0,20)
                    this.vehicule.setVelocityX(-200)
                    } else if (this.moveRight) {
                        this.vehicule.setSize(180,70,true)
                        this.vehicule.setOffset(0, 20)
                        this.vehicule.setVelocityX(200)
                    }
                if (this.moveUp) {
                    this.vehicule.setSize(80,96,true)
                    this.vehicule.setVelocityY(-200)
                    } else if (this.moveDown) {
                        this.vehicule.setSize(80,96,true)
                        this.vehicule.setVelocityY(200)
                }

                this.vehicule.body.velocity.normalize().scale(200)

                if (this.moveUp) {
                    this.vehicule.anims.play('animVehiculeBack', true)
                } else if (this.moveDown) {
                    this.vehicule.anims.play('animVehiculeFront', true)
                } else
                if (this.moveLeft) {
                    this.vehicule.anims.play('animVehiculeLeft', true)
                } else if (this.moveRight) {
                    this.vehicule.anims.play('animVehiculeRight', true)
                }   
                if (this.cursors.up.isUp && this.cursors.down.isUp && this.cursors.left.isUp && this.cursors.right.isUp){
                    this.vehicule.anims.play('animVehiculeNoMove', true);
                    this.vehicule.setVelocityX(0)
                    this.vehicule.setVelocityY(0)
                }
                
            }

            if (this.vehicule.x > 500){
                this.vehicule.anims.play('animVehiculeStop', true)
            }

            if (this.quitterVheicule == true){
                this.entrerActif = false
                this.cameras.main.startFollow(this.player); 
                this.cameras.main.zoom = 3
                this.vehicule.setVelocityX(0)
                this.vehicule.setVelocityY(0)
                this.animVehicule = false
                this.physics.add.collider(this.player, this.vehicule);
                this.vehicule.setPushable(false)
            }

            // timer pour l'invulnérabilité
            if(this.invulnérable == true){
                this.compteurInvunlerable -=1 ;
                if(this.compteurInvunlerable == 0){
                    this.compteurInvunlerable = 150;
                    this.player.setTint(0xffffff);
                    this.invulnérable = false ;
                }
            }

            if(this.tempsAvantRespawn == true){
                this.compteurTempsAvantRespawn -=1 ;
                if(this.compteurTempsAvantRespawn == 0){
                    this.tempsAvantRespawn = false ;
                    this.scene.restart()
                }
            }

            //sabre interface
            if (this.sabreInterface == true){
                this.sabreEcran = this.add.image(390, 162,'sabreInterface').setScale(0.4)
                this.sabreEcran.setInteractive()
                this.sabreEcran.setScrollFactor(0);  
                this.sabreEcran.setDepth(10)
            }
            
            //carte magnétique interface
            if (this.carteMagnetiqueInterface == true){
                this.carteMagnetiqueEcran = this.add.image(368, 162,'carteMagnetiqueInterface').setScale(0.4)
                this.carteMagnetiqueEcran.setScrollFactor(0);  
                this.carteMagnetiqueEcran.setDepth(10)
            }

            // stop animation du coffre
            if(this.coffreAnimStop == true){
                this.compteurAnimCoffre -=1 ;
                if(this.compteurAnimCoffre == 0){
                    this.coffreOuvert.anims.stop("coffreAnim", false)
                }
            }

            // affichage background réacteurs sur l'interface
            if (this.reacteursBackgroundInterface == true){
                this.reacteursEcranBackground = this.add.image(476, 170,'reacteursInterfaces').setScale(0.5)
                this.reacteursEcranBackground.setScrollFactor(0);  
                this.reacteursEcranBackground.setDepth(10)
            }
            // réacteur 1 interface
            if (this.reacteur1Pris == true){
                this.reacteur1Ecran = this.add.image(464, 174,'réacteur1').setScale(0.4)
                this.reacteur1Ecran.setInteractive()
                this.reacteur1Ecran.setScrollFactor(0);  
                this.reacteur1Ecran.setDepth(10)
            }
            // réacteur 2 interface
            if (this.reacteur2Pris == true){
                this.reacteur1Ecran = this.add.image(488, 174,'réacteur2').setScale(0.4)
                this.reacteur1Ecran.setScrollFactor(0);  
                this.reacteur1Ecran.setDepth(10)
            }

            // timer pour prendre le drop du coffre
            if(this.dropCoffreActif == true){
                this.compteurDropCoffre -=1 ;
                if(this.compteurDropCoffre == 0){
                    this.compteurDropCoffre = 150;
                    this.physics.add.overlap(this.playerCollision2,this.dropCoffre,this.prendreDropCoffre,null,this)
                    this.dropCoffreActif = false ;
                }
            }

            // drop du coffre interface
            if (this.dropCoffreInterface == true){
                this.bidonEssenceInterface = this.add.image(412, 162,'bidonEssenceInterface').setScale(0.4)
                this.bidonEssenceInterface.setScrollFactor(0);  
                this.bidonEssenceInterface.setDepth(10)
            }

            this.barreDeVie()
        }

        ouvrirCoffre(player,coffre){
            if (Phaser.Input.Keyboard.JustDown(this.toucheF)) {
                coffre.destroy()
                this.coffreOuvert = this.physics.add.sprite(coffre.x,coffre.y,'coffreAnim1')
                this.coffreOuvert.anims.play("coffreAnim", true);
                this.coffreAnimStop = true

                this.dropCoffre = this.physics.add.image(this.coffreOuvert.x - 16, this.coffreOuvert.y - 35 , 'bidonEssence').setScale(0.9).setOrigin(0);
                this.dropCoffreActif = true
            }
        }

        prendreDropCoffre(player,dropCoffre){
            dropCoffre.destroy()
            this.dropCoffreInterface = true
        }

        collectSabre(player,sabre){
            sabre.disableBody(true, true); 
            this.pouvoirAttaquer = true
        }

        toucherEnnemi (player, enemis) {
            if (this.trancherActif == true){
                this.imageMort = this.add.image(enemis.x + 15, enemis.y + 12, 'ennemiMort');
                this.imageMort.setDepth(0)
                enemis.destroy();
            }
        }  

        entrerVehicule(player,vehicule){
            if (this.entrerActif == true){
                if (Phaser.Input.Keyboard.JustDown(this.toucheF)) { 
                    this.animVehicule = true
                }
                
                if (this.animVehicule == true){
                    this.cameras.main.startFollow(vehicule); 
                    this.cameras.main.zoom = 2
                    this.player.x = this.vehicule.x
                    this.player.y = this.vehicule.y
                }
                if (vehicule.x > 500){
                    this.player.x = this.vehicule.x + 160
                    this.player.y = this.vehicule.y + 5
                    this.quitterVheicule = true
                }
            }
        }

        perdPvEnnemi(player,ennemis){
            if (this.invulnérable === false){
                this.invulnérable = true;
                this.pointDeVie -= 1;
                player.setTint(0xff0000);
            }
        }

        prendreHp (player,coeur){
            coeur.destroy(); 
            this.pointDeVie += 1
            if (this.pointDeVie > 4){
                this.pointDeVie = 4
            }
        }

        prendreMonnaie(player,monnaie){
            monnaie.destroy(); 
            this.solde += 1
            this.monnaieTexte.setText(this.solde)
        }

        ouvrirPorteGrotte(player,porteGrotteOverlap){
            if (this.carteMagnetiqueInterface == true){
                if (this.porteOuverte == false){
                    if (Phaser.Input.Keyboard.JustDown(this.toucheF)) { 
                        this.porteGrotte.setTexture('porteEntreeGrotteOuvert')
                        this.porteGrotte.body.setSize(48,32,true)
                        this.porteGrotte.setOffset(2,32,true)
                        this.porteOuverte = true
                    }
                }

                if (this.porteOuverte == true){
                    if (Phaser.Input.Keyboard.JustDown(this.toucheF)) { 
                        this.porteGrotte.setTexture('porteEntreeGrotteFermée')
                        this.porteGrotte.body.setSize(96,32,true)
                        this.porteGrotte.setOffset(2,32,true)
                        this.porteOuverte = false
                    }
                }
            }
        }

        toucherEnnemi (player, enemis) {
            if (this.trancherActif == true){
                this.imageMort = this.add.image(enemis.x + 15, enemis.y + 12, 'ennemiMort');
                this.imageMort.setDepth(1)
                enemis.destroy(); 
            }
        }  

        perdPvEnnemi(player,ennemis){
            if (this.invulnérable === false){
                this.invulnérable = true;
                this.pointDeVie -= 1;
                player.setTint(0xff0000);
            }
        }

        prendreReacteur2(player,reacteur2){
            reacteur2.destroy()
            this.reacteur2Pris = true
        }

        barreDeVie (){
            if (this.pointDeVie == 4){
                this.coeurEcran.setTexture('4HP')
            }
            if (this.pointDeVie == 3){
                this.coeurEcran.setTexture('3HP')
            }
            if (this.pointDeVie == 2){
                this.coeurEcran.setTexture('2HP')
            }
            if (this.pointDeVie == 1){
                this.coeurEcran.setTexture('1HP')
            }
            if (this.pointDeVie == 0){
                this.coeurEcran.setTexture('0HP')
                this.dialogue = true
                this.player.anims.play('persoMort', false); 
                this.tempsAvantRespawn = true
            }
        }

        /////////////////////////////////////////
        ////////DISCUSSIONS AVEC LES PNJ/////////
        /////////////////////////////////////////
        parlerPNJ1(player,pnj1){
            if (Phaser.Input.Keyboard.JustDown(this.toucheF)) { 
                this.dialogue = true
                this.textintro = this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"TexteIntro1").setScale(0.35)
                this.textintro.setDepth(11)
                this.textintro.setScrollFactor(0)
                this.textintro.setInteractive()
                this.deuxiemeDialogue = true
            }
            if (this.deuxiemeDialogue == true){
                if (Phaser.Input.Keyboard.JustDown(this.toucheG)) {
                    this.textintro.setTexture('TexteIntro2') 
                    this.dernierDialogue = true
                    this.deuxiemeDialogue = false              
                }
            }
            if (this.dernierDialogue == true){
                if (Phaser.Input.Keyboard.JustDown(this.toucheG)) {
                    this.textintro.destroy()
                    this.dialogue = false
                }
            }
        }

        goInsideGrotto(player,entreeGrotte){
            if (Phaser.Input.Keyboard.JustDown(this.toucheF)) { 
                this.scene.start("sceneGrotte", {
                    pointDeVie:this.pointDeVie,
                    sabreInterface:this.sabreInterface,
                    dialogue:this.dialogue,
                    trancherActif:this.trancherActif,
                    pouvoirAttaquer:this.pouvoirAttaquer,
                    animVehicule:this.animVehicule,
                    quitterVheicule:this.quitterVheicule,
                    invulnérable:this.invulnérable,
                    tempsAvantRespawn:this.tempsAvantRespawn,
                    porteOuverte:this.porteOuverte,
                    entreeBatiment: this.entreeBatiment,
                    carteMagnetiqueInterface: this.carteMagnetiqueInterface,
                    solde: this.solde,
                    reacteur1Pris: this.reacteur1Pris,
                    reacteur2Pris:this.reacteur2Pris,
                    reacteursBackgroundInterface: this.reacteursBackgroundInterface
                })
            }
        }

        goInsideWhiteHouse(player,entreeMaisonBlanche){
            if (Phaser.Input.Keyboard.JustDown(this.toucheF)) { 
                this.scene.start("sceneMaisonBlanche", {
                    pointDeVie:this.pointDeVie,
                    sabreInterface:this.sabreInterface,
                    dialogue:this.dialogue,
                    trancherActif:this.trancherActif,
                    pouvoirAttaquer:this.pouvoirAttaquer,
                    animVehicule:this.animVehicule,
                    quitterVheicule:this.quitterVheicule,
                    invulnérable:this.invulnérable,
                    tempsAvantRespawn:this.tempsAvantRespawn,
                    porteOuverte:this.porteOuverte,
                    entreeBatiment: this.entreeBatiment,
                    carteMagnetiqueInterface: this.carteMagnetiqueInterface,
                    solde: this.solde,
                    reacteur1Pris: this.reacteur1Pris,
                    reacteur2Pris:this.reacteur2Pris,
                    reacteursBackgroundInterface: this.reacteursBackgroundInterface
                })
            }
        }

        goInside1stHouse(player,entreeMaison1){
            if (Phaser.Input.Keyboard.JustDown(this.toucheF)) { 
                this.scene.start("sceneMaison1", {
                    pointDeVie:this.pointDeVie,
                    sabreInterface:this.sabreInterface,
                    dialogue:this.dialogue,
                    trancherActif:this.trancherActif,
                    pouvoirAttaquer:this.pouvoirAttaquer,
                    animVehicule:this.animVehicule,
                    quitterVheicule:this.quitterVheicule,
                    invulnérable:this.invulnérable,
                    tempsAvantRespawn:this.tempsAvantRespawn,
                    porteOuverte:this.porteOuverte,
                    entreeBatiment: this.entreeBatiment,
                    carteMagnetiqueInterface: this.carteMagnetiqueInterface,
                    solde: this.solde,
                    reacteur1Pris: this.reacteur1Pris,
                    reacteur2Pris:this.reacteur2Pris,
                    reacteursBackgroundInterface: this.reacteursBackgroundInterface
                })
            }
        }
        
    }
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////AUTRE SCENE///////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
    class sceneGrotte extends Phaser.Scene{
            constructor(){
            super("sceneGrotte");
        }

        init(data){
            this.pointDeVie = data.pointDeVie,
            this.sabreInterface = data.sabreInterface,
            this.dialogue = data.dialogue,
            this.trancherActif = data.trancherActif,
            this.pouvoirAttaquer = data.pouvoirAttaquer,
            this.animVehicule = data.animVehicule,
            this.quitterVheicule = data.quitterVheicule,
            this.invulnérable = data.invulnérable,
            this.tempsAvantRespawn = data.tempsAvantRespawn,
            this.porteOuverte = data.porteOuverte,
            this.entreeBatiment = data.entreeBatiment,
            this.carteMagnetiqueInterface = data.carteMagnetiqueInterface,
            this.solde = data.solde,
            this.reacteur1Pris = data.reacteur1Pris,
            this.reacteur2Pris = data.reacteur2Pris,
            this.reacteursBackgroundInterface = data.reacteursBackgroundInterface
        }

        preload(){
            this.load.image("Phaser_tuilesdejeu", "assets/tuilesJeu.png");

            this.load.tilemapTiledJSON("carte2", "mapAutreScenes.json");  

            this.load.spritesheet('perso','assets/perso.png',
            { frameWidth: 32, frameHeight: 32 });
            this.load.spritesheet('persoMort','assets/persoMort.png',
            { frameWidth: 32, frameHeight: 32 });
            this.load.spritesheet('animAttaque','assets/animAttaque.png',
            { frameWidth: 32, frameHeight: 48 });

            this.load.spritesheet('ennemi','assets/ennemi.png',
            { frameWidth: 31, frameHeight: 20 });

            // sprite vehicule
            this.load.spritesheet('vehiculeBackFront','assets/vehiculeBackFront.png',
            { frameWidth: 80, frameHeight: 96 });
            this.load.spritesheet('vehiculeRightLeft','assets/vehiculeRightLeft.png',
            { frameWidth: 160, frameHeight: 96 });

            this.load.image("sabre", "assets/objets/sabre.png");
            this.load.image("sabreInterface", "assets/interface/sabreInterface.png");

            // carte magnétique interface
            this.load.image("carteMagnetiqueInterface", "assets/interface/carteMagnetiqueInterface.png");

            // hitbox perso différente de celle avec laquelle il est en collision avec les builds
            this.load.image("hitbox", "assets/objets/emplacementChangementDeScene/changementScene.png");

            this.load.image("ennemiMort", "assets/ennemiMort.png");
            
            // emplacement Changement De Scene
            this.load.image("changementScene", "assets/objets/emplacementChangementDeScene/changementScene.png");

            this.load.image("monnaie", "assets/objets/monnaie.png");
            this.load.image("monnaieInterface", "assets/interface/monnaieInterface.png");

            // frame barre de vie
            this.load.image("4HP", "assets/interface/vie/coeurInterface4HP.png");
            this.load.image("3HP", "assets/interface/vie/coeurInterface3HP.png");
            this.load.image("2HP", "assets/interface/vie/coeurInterface2HP.png");
            this.load.image("1HP", "assets/interface/vie/coeurInterface1HP.png");
            this.load.image("0HP", "assets/interface/vie/coeurInterface0HP.png");

            // reacteurs
            this.load.image("réacteur1", "assets/objets/réacteur1.png");
            this.load.image("réacteur2", "assets/objets/réacteur2.png");
            this.load.image("reacteursInterfaces", "assets/interface/reacteursInterfaces.png");
            this.load.image("texteRecupReacteur1", "assets/interface/texte/TexteRecupReacteur1.png");
        }

         


        create(){
            const carte2 = this.make.tilemap({ key: 'carte2' });

            // importer les TileSet 
            const tileset = carte2.addTilesetImage(
                    "tuilesJeu",
                    "Phaser_tuilesdejeu"
                    );  

            const groundGrotte = carte2.createLayer(
                    "groundGrotte",
                    tileset
                    );
            groundGrotte.setDepth(0)

            const buildGrotte = carte2.createLayer(
                    "buildGrotte",
                    tileset
                    );

            const murTrouGrotte = carte2.createLayer(
                    "murTrouGrotte",
                    tileset
                    );

            this.sortieGrotte = this.physics.add.image(882,76, 'changementScene');
            this.sortieGrotte.body.setSize(64,50,true)
            this.sortieGrotte.setOffset(-16, 6)
            
            this.player = this.physics.add.sprite(882,100,'perso');
            this.player.body.setSize(24,6,true)
            this.player.setOffset(4, 26)

            this.player.setDepth(2)

            this.playerCollision2 = this.physics.add.image(50,50,"hitbox")
            this.playerCollision2.body.setSize(32,22)
            this.playerCollision2.setOffset(0,10)

            const persoDerriereGrotte = carte2.createLayer(
                    "persoDerriereGrotte",
                    tileset
                    );
                    
            persoDerriereGrotte.setDepth(3)

            this.compteurAttaqueTemps = 60
            this.compteurInvunlerable = 150
            this.compteurTempsAvantRespawn = 300
            this.test = 0
            this.reacteurObtenu = false

            this.physics.add.collider(this.player, buildGrotte);
            buildGrotte.setCollisionByProperty({ estSolide: true });

            // collision avec l'entrée de la grotte
            this.physics.add.overlap(this.player, this.sortieGrotte, this.goOutGrotto, null, this)

            this.player.setCollideWorldBounds(true);

            this.cameras.main.zoom = 3
            this.cameras.main.startFollow(this.player); 
            this.physics.world.setBounds(0, 0, 6400, 1600);
            this.cameras.main.setBounds(0, 0, 6400, 1600);

            this.anims.create({
                key: 'left',
                frames: this.anims.generateFrameNumbers('perso', {start:18,end:23}),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'right',
                frames: this.anims.generateFrameNumbers('perso', {start:12,end:17}),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'front',
                frames: this.anims.generateFrameNumbers('perso', {start:0,end:5}),
                frameRate: 8,
                repeat: -1
            });

            this.anims.create({
                key: 'back',
                frames: this.anims.generateFrameNumbers('perso', {start:6,end:11}),
                frameRate: 8,
                repeat: -1
            });

            this.anims.create({
                key: 'noMove',
                frames: this.anims.generateFrameNumbers('perso', {start:24,end:31}),
                frameRate: 8,
                repeat: -1
            });

            // animation de mort
            this.anims.create({
                key: 'persoMort',
                frames: this.anims.generateFrameNumbers('persoMort', {start:0,end:3}),
                frameRate: 5,
            });
            
            // animations lorsque le joueur à le sabre en main
            this.anims.create({
                key: 'leftSaber',
                frames: this.anims.generateFrameNumbers('animAttaque', {start:15,end:19}),
                frameRate: 12,
                repeat: -1
            });
            this.anims.create({
                key: 'rightSaber',
                frames: this.anims.generateFrameNumbers('animAttaque', {start:10,end:14}),
                frameRate: 12,
                repeat: -1
            });
            this.anims.create({
                key: 'frontSaber',
                frames: this.anims.generateFrameNumbers('animAttaque', {start:0,end:4}),
                frameRate: 12,
                repeat: -1
            });

            this.anims.create({
                key: 'backSaber',
                frames: this.anims.generateFrameNumbers('animAttaque', {start:5,end:9}),
                frameRate: 12,
                repeat: -1
            });

            this.anims.create({
                key: 'noMoveSaber',
                frames: this.anims.generateFrameNumbers('animAttaque', {start:20,end:24}),
                frameRate: 12,
                repeat: -1
            });

            // animation ennemis
            this.anims.create({
                key: 'frontEnnemis',
                frames: this.anims.generateFrameNumbers('ennemi', {start:0,end:5}),
                frameRate: 12,
                repeat: -1
            });
            this.anims.create({
                key: 'backEnnemis',
                frames: this.anims.generateFrameNumbers('ennemi', {start:6,end:11}),
                frameRate: 12,
                repeat: -1
            });

            // apparition des ennemis
            this.enemis = this.physics.add.group({
            });
                    
            carte2.getObjectLayer('spawnEnnemi').objects.forEach((enemis) => {
            this.enemi = this.enemis.create(enemis.x, enemis.y, 'ennemi').setOrigin(0);
            this.enemi.setBounce(1);
            });

            this.enemis.setVelocityY(-100)
            
            this.physics.add.overlap( this.player, this.enemis,  this.toucherEnnemi, null,this);

            this.physics.add.collider(this.enemis,buildGrotte,this.changeDirection, null,this);

            // apparition du sabre à récupérer sur la map
            this.sabre = this.physics.add.group({
            });
                    
            carte2.getObjectLayer('sabre').objects.forEach((sabre) => {
            this.sabre.create(sabre.x, sabre.y, 'sabre').setOrigin(0);
            });

            this.physics.add.overlap(this.player, this.sabre, this.collectSabre, null, this)

            // coeur à récupérer
            this.coeur = this.physics.add.group({
            });
                    
            carte2.getObjectLayer('coeur').objects.forEach((coeur) => {
            this.coeur.create(coeur.x, coeur.y, 'coeur').setOrigin(0);
            });

            this.physics.add.overlap( this.playerCollision2,this.coeur,this.prendreHp, null,this);

            this.coeur.setDepth(9)            

            // réacteurs à récupérer        
            carte2.getObjectLayer('reacteurs').objects.forEach((reacteurs) => {
            this.reacteur1 = this.physics.add.image(reacteurs.x, reacteurs.y, 'réacteur1').setScale(0.6).setOrigin(0);
            });

            this.physics.add.overlap( this.playerCollision2, this.reacteur1,  this.prendreReacteur1, null,this);


            ///////////////////////////////////////////////////////////////
            /////////////////////////INTERFACE/////////////////////////////
            ///////////////////////////////////////////////////////////////

            //vie interface
            this.coeurEcran = this.add.image(306, 161,'8HP').setScale(0.7 )
            this.coeurEcran.setInteractive()
            this.coeurEcran.setScrollFactor(0);  

            this.coeurEcran.setDepth(10)

            // monnaie interface
            this.monnaieEcran = this.add.image(275, 185,'monnaieInterface').setScale(0.5);
            this.monnaieEcran.setDepth(100)
            this.monnaieEcran.setScrollFactor(0);  
            this.monnaieTexte = this.add.text(288, 174,this.solde, {
                font: '30px Poppins semibold',
                fill: "#0022BD" 
            });
            this.monnaieTexte.setDepth(100)
            this.monnaieTexte.setScale(0.7);
            this.monnaieTexte.setScrollFactor(0);

            ///////////////////////////////////////////////////////////////
            /////////////////////////TOUCHES///////////////////////////////
            ///////////////////////////////////////////////////////////////

            this.cursors = this.input.keyboard.createCursorKeys();
            this.keys = this.input.keyboard.addKeys({
                q:  this.input.keyboard.addKey('Q'),
                d:  this.input.keyboard.addKey('D'),
                z:  this.input.keyboard.addKey('Z'),
                s:  this.input.keyboard.addKey('S'),
            });

            this.toucheF = this.input.keyboard.addKey('F');
            this.toucheG = this.input.keyboard.addKey('G');
            this.trancher = this.input.keyboard.addKey('A');
        }

        update(){
            this.playerCollision2.x = this.player.x
            this.playerCollision2.y = this.player.y

            this.enemis.playAnimation("frontEnnemis",[0])

            if (this.dialogue ==false){

                this.moveUp = ( this.cursors.up.isDown || this.keys.z.isDown )  
                this.moveLeft = ( this.cursors.left.isDown || this.keys.q.isDown )  
                this.moveRight = ( this.cursors.right.isDown || this.keys.d.isDown ) 
                this.moveDown = ( this.cursors.down.isDown || this.keys.s.isDown ) 
                

                const speed = 100

                    if (this.moveLeft) {
                        this.player.setVelocityX(-speed)
                        this.player.direction = 'left';
                    } else if (this.moveRight) {
                        this.player.setVelocityX(speed)
                        this.player.direction = 'right';
                    }

                    if (this.moveUp) {
                        this.player.setVelocityY(-speed)
                        this.player.direction = 'up';
                    } else if (this.moveDown) {
                        this.player.setVelocityY(speed)
                        this.player.direction = 'down';
                    }

                    this.player.body.velocity.normalize().scale(speed)

                if (this.trancherActif == false){
                    if (this.moveUp) {
                        this.player.anims.play('back', true)
                    } else if (this.moveDown) {
                        this.player.anims.play('front', true)
                    } else
                    if (this.moveLeft) {
                        this.player.anims.play('left', true)
                    } else if (this.moveRight) {
                        this.player.anims.play('right', true)
                    }   

                    if (this.cursors.up.isUp && this.cursors.down.isUp && this.cursors.left.isUp && this.cursors.right.isUp){
                        this.player.anims.play('noMove', true);
                        this.player.direction = 'none';
                        this.player.setVelocityX(0)
                        this.player.setVelocityY(0)
                    }
                    this.physics.add.overlap(this.playerCollision2, this.enemis, this.perdPvEnnemi, null,this);
                }
                if (this.trancherActif == true){
                    if (this.moveUp) {
                        this.player.anims.play('backSaber', true)
                    } else if (this.moveDown) {
                        this.player.anims.play('frontSaber', true)
                    } else
                    if (this.moveLeft) {
                        this.player.anims.play('leftSaber', true)
                    } else if (this.moveRight) {
                        this.player.anims.play('rightSaber', true)
                    }   

                    if (this.cursors.up.isUp && this.cursors.down.isUp && this.cursors.left.isUp && this.cursors.right.isUp){
                        this.player.anims.play('noMoveSaber', true);
                        this.player.direction = 'none';
                        this.player.setVelocityX(0)
                        this.player.setVelocityY(0)
                    }
                }
            }

            if( this.pouvoirAttaquer == true){
                if (Phaser.Input.Keyboard.JustDown(this.trancher)) {   
                    this.trancherActif = true
                    this.tempsAttaque = true
                    if (this.player.direction == 'down'){
                        this.player.setSize(32,32,true)
                        this.player.setOffset(0, 15)
                    }
                    if (this.player.direction == 'up'){
                        this.player.setSize(32,30,true)
                        this.player.setOffset(0, 2)
                    }
                    if (this.player.direction == 'left'){
                        this.player.setSize(16,28,true)
                        this.player.setOffset(0, 12)
                    }
                    if (this.player.direction == 'right'){
                        this.player.setSize(16,28,true)
                        this.player.setOffset(18, 12)
                    }
                    if (this.player.direction == 'none'){
                        this.player.setSize(32,30,true)
                        this.player.setOffset(0, 17)
                    }
                }
            }
        

        
            if (this.test > 0){
                if (this.monnaieTest.x > this.player.x)
                {this.monnaieTest.setVelocityX(-120)}
                if (this.monnaieTest.x < this.player.x)
                {this.monnaieTest.setVelocityX(120)}
                if (this.monnaieTest.y < this.player.y)
                {this.monnaieTest.setVelocityY(120)}
                if (this.monnaieTest.y > this.player.y)
                {this.monnaieTest.setVelocityY(-120)}
            } 

            if ( this.tempsAttaque == false) {   
                this.trancherActif = false
                this.player.setSize(24,6,true)
                this.player.setOffset(4, 26)
            }

            if(this.tempsAttaque == true){
                this.compteurAttaqueTemps -=1 ;
                if(this.compteurAttaqueTemps == 0){
                    this.compteurAttaqueTemps = 60;
                    this.tempsAttaque = false ;
                }
            }

            // timer pour l'invulnérabilité
            if(this.invulnérable == true){
                this.compteurInvunlerable -=1 ;
                if(this.compteurInvunlerable == 0){
                    this.compteurInvunlerable = 150;
                    this.player.setTint(0xffffff);
                    this.invulnérable = false ;
                }
            }

            if(this.tempsAvantRespawn == true){
                this.compteurTempsAvantRespawn -=1 ;
                if(this.compteurTempsAvantRespawn == 0){
                    this.tempsAvantRespawn = false ;
                    this.scene.restart()
                }
            }

            //sabre interface
            if (this.sabreInterface == true){
                this.sabreEcran = this.add.image(390, 162,'sabreInterface').setScale(0.4)
                this.sabreEcran.setInteractive()
                this.sabreEcran.setScrollFactor(0);  
                this.sabreEcran.setDepth(10)
            }

            //carte magnétique interface
            if (this.carteMagnetiqueInterface == true){
                this.carteMagnetiqueEcran = this.add.image(368, 162,'carteMagnetiqueInterface').setScale(0.4)
                this.carteMagnetiqueEcran.setInteractive()
                this.carteMagnetiqueEcran.setScrollFactor(0);  
                this.carteMagnetiqueEcran.setDepth(10)
            }

            // affichage background réacteurs sur l'interface
            if (this.reacteursBackgroundInterface == true){
                this.reacteursEcranBackground = this.add.image(476, 170,'reacteursInterfaces').setScale(0.5)
                this.reacteursEcranBackground.setScrollFactor(0);  
                this.reacteursEcranBackground.setDepth(10)
            }
            // réacteur 1 interface
            if (this.reacteur1Pris == true){
                this.reacteur1Ecran = this.add.image(464, 174,'réacteur1').setScale(0.4)
                this.reacteur1Ecran.setScrollFactor(0);  
                this.reacteur1Ecran.setDepth(10)
            }
            // réacteur 2 interface
            if (this.reacteur2Pris == true){
                this.reacteur1Ecran = this.add.image(488, 174,'réacteur2').setScale(0.4)
                this.reacteur1Ecran.setScrollFactor(0);  
                this.reacteur1Ecran.setDepth(10)
            }

            if (this.reacteurObtenu == true){
                if (Phaser.Input.Keyboard.JustDown(this.toucheG)) {
                    this.texteReacteurObtenu.destroy()
                    this.dialogue = false
                    this.reacteur1Pris = true
                }
            }  

            this.barreDeVie()
        }

        collectSabre(player,sabre){
            sabre.destroy(); 
            this.pouvoirAttaquer = true
            this.sabreInterface = true
        }

        toucherEnnemi (player, enemis) {
            if (this.trancherActif == true){
                this.imageMort = this.add.image(enemis.x + 15, enemis.y + 12, 'ennemiMort');
                this.imageMort.setDepth(1)
                this.monnaieTest = this.physics.add.image(enemis.x, enemis.y - 70, 'monnaie').setScale(0.6).setOrigin(0);
                this.physics.add.overlap( this.playerCollision2, this.monnaieTest,  this.prendreMonnaie, null,this);
                this.test++
                this.monnaieTest.setDepth(2)
                enemis.destroy(); 
            }
        }  

        perdPvEnnemi(playerCollision2,ennemis){
            if (this.invulnérable === false){
                this.invulnérable = true;
                this.pointDeVie -= 1;
                this.player.setTint(0xff0000);
            }
        }

        prendreHp (player,coeur){
            coeur.destroy(); 
            this.pointDeVie += 1
            if (this.pointDeVie > 4){
                this.pointDeVie = 4
            }
        }

        prendreMonnaie(player,monnaie){
            if  (this.test > 0){
                monnaie.destroy(); 
                this.solde += 1
                this.monnaieTexte.setText(this.solde)
                this.test --
            }
            
        }

        prendreReacteur1(player,reacteur1){
            reacteur1.destroy()
            if (this.reacteurObtenu == false){
                this.dialogue = true
                this.texteReacteurObtenu = this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"texteRecupReacteur1").setScale(0.35)
                this.texteReacteurObtenu.setDepth(11)
                this.texteReacteurObtenu.setScrollFactor(0)
                this.reacteurObtenu = true
            }
        }

        barreDeVie (){
            if (this.pointDeVie == 4){
                this.coeurEcran.setTexture('4HP')
            }
            if (this.pointDeVie == 3){
                this.coeurEcran.setTexture('3HP')
            }
            if (this.pointDeVie == 2){
                this.coeurEcran.setTexture('2HP')
            }
            if (this.pointDeVie == 1){
                this.coeurEcran.setTexture('1HP')
            }
            if (this.pointDeVie == 0){
                this.coeurEcran.setTexture('0HP')
                this.dialogue = true
                this.player.anims.play('persoMort', false); 
                this.tempsAvantRespawn = true
            }
        }

        goOutGrotto(player,sortieGrotte){
            if (Phaser.Input.Keyboard.JustDown(this.toucheF)) { 
                this.scene.start("sceneJeu", {
                    pointDeVie:this.pointDeVie,
                    sabreInterface:this.sabreInterface,
                    dialogue:this.dialogue,
                    trancherActif:this.trancherActif,
                    pouvoirAttaquer:this.pouvoirAttaquer,
                    animVehicule:this.animVehicule,
                    quitterVheicule:this.quitterVheicule,
                    invulnérable:this.invulnérable,
                    tempsAvantRespawn:this.tempsAvantRespawn,
                    porteOuverte:this.porteOuverte,
                    entreeBatiment: true,
                    spawnXSortieScene:410, 
                    spawnYSortieScene:80,
                    carteMagnetiqueInterface: this.carteMagnetiqueInterface,
                    solde: this.solde,
                    reacteur1Pris: this.reacteur1Pris,
                    reacteur2Pris:this.reacteur2Pris,
                    reacteursBackgroundInterface: this.reacteursBackgroundInterface
                })
            }
        }
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////AUTRE SCENE///////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    

    class sceneMaison1 extends Phaser.Scene{
            constructor(){
            super("sceneMaison1");
        }

        init(data){
            this.pointDeVie = data.pointDeVie,
            this.sabreInterface = data.sabreInterface,
            this.dialogue = data.dialogue,
            this.trancherActif = data.trancherActif,
            this.pouvoirAttaquer = data.pouvoirAttaquer,
            this.animVehicule = data.animVehicule,
            this.quitterVheicule = data.quitterVheicule,
            this.invulnérable = data.invulnérable,
            this.tempsAvantRespawn = data.tempsAvantRespawn
            this.porteOuverte = data.porteOuverte,
            this.entreeBatiment = data.entreeBatiment,
            this.carteMagnetiqueInterface = data.carteMagnetiqueInterface,
            this.solde = data.solde,
            this.reacteur1Pris = data.reacteur1Pris,
            this.reacteur2Pris = data.reacteur2Pris,
            this.reacteursBackgroundInterface = data.reacteursBackgroundInterface
        }

        preload(){
            this.load.image("Phaser_tuilesMaisonLunaire", "assets/interieur maison zone lunaire.png");

            this.load.tilemapTiledJSON("carte2", "mapAutreScenes.json");  

            this.load.spritesheet('perso','assets/perso.png',
            { frameWidth: 32, frameHeight: 32 });

            this.load.image("sabreInterface", "assets/interface/sabreInterface.png");

            // emplacement Changement De Scene
            this.load.image("changementScene", "assets/objets/emplacementChangementDeScene/changementScene.png");

            // frame barre de vie
            this.load.image("4HP", "assets/interface/vie/coeurInterface4HP.png");
            this.load.image("3HP", "assets/interface/vie/coeurInterface3HP.png");
            this.load.image("2HP", "assets/interface/vie/coeurInterface2HP.png");
            this.load.image("1HP", "assets/interface/vie/coeurInterface1HP.png");
            this.load.image("0HP", "assets/interface/vie/coeurInterface0HP.png");

            this.load.image("monnaie", "assets/objets/monnaie.png");
            this.load.image("monnaieInterface", "assets/interface/monnaieInterface.png");

            // textes PNJ
            this.load.image("TexteAvantGrotte1", "assets/interface/texte/TexteAvantGrotte 1.png");
            this.load.image("TexteAvantGrotte2", "assets/interface/texte/TexteAvantGrotte 2.png");
            this.load.image("TexteAprèstGrotte", "assets/interface/texte/TexteAprèstGrotte.png");

            // reacteurs
            this.load.image("réacteur1", "assets/objets/réacteur1.png");
            this.load.image("réacteur2", "assets/objets/réacteur2.png");
            this.load.image("reacteursInterfaces", "assets/interface/reacteursInterfaces.png");
        }

        create(){
            const carte2 = this.make.tilemap({ key: 'carte2' });

            // importer les TileSet 
            const tilesetMaisonHerbe = carte2.addTilesetImage(
                    "interieur maison zone lunaire",
                    "Phaser_tuilesMaisonLunaire"
                    );

            const groundMaisonLunaire = carte2.createLayer(
                    "groundMaisonLunaire",
                    tilesetMaisonHerbe
                    );

            const buildMaisonLunaire = carte2.createLayer(
                    "buildMaisonLunaire",
                    tilesetMaisonHerbe
                    );

            this.sortieMaisonLunaire = this.physics.add.image(2000,1390, 'changementScene');
            this.sortieMaisonLunaire.body.setSize(128,50,true)
            
            this.player = this.physics.add.sprite(2000,1380,'perso');
            this.player.body.setSize(24,6,true)
            this.player.setOffset(4, 26)

            this.player.setDepth(9)

            const persoDerriereMaisonLunaire = carte2.createLayer(
                    "persoDerriereMaisonLunaire",
                    tilesetMaisonHerbe
                    );

            persoDerriereMaisonLunaire.setDepth(10)

            this.physics.add.collider(this.player, buildMaisonLunaire);
            buildMaisonLunaire.setCollisionByProperty({ estSolide: true });

            // collision avec l'entrée de la grotte
            this.physics.add.overlap(this.player, this.sortieMaisonLunaire, this.goOut1stHouse, null, this)

            this.player.setCollideWorldBounds(true);

            this.cameras.main.zoom = 3
            this.cameras.main.startFollow(this.player); 
            this.physics.world.setBounds(0, 0, 6400, 1600);
            this.cameras.main.setBounds(0, 0, 6400, 1600);

            this.anims.create({
                key: 'left',
                frames: this.anims.generateFrameNumbers('perso', {start:18,end:23}),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'right',
                frames: this.anims.generateFrameNumbers('perso', {start:12,end:17}),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'front',
                frames: this.anims.generateFrameNumbers('perso', {start:0,end:5}),
                frameRate: 8,
                repeat: -1
            });

            this.anims.create({
                key: 'back',
                frames: this.anims.generateFrameNumbers('perso', {start:6,end:11}),
                frameRate: 8,
                repeat: -1
            });

            this.anims.create({
                key: 'noMove',
                frames: this.anims.generateFrameNumbers('perso', {start:24,end:31}),
                frameRate: 8,
                repeat: -1
            });

             // monnaie à récupérer
             this.monnaie = this.physics.add.group({
            });
                    
            carte2.getObjectLayer('monnaie').objects.forEach((monnaie) => {
            this.monnaie.create(monnaie.x, monnaie.y, 'monnaie').setScale(0.7).setOrigin(0);
            });

            this.physics.add.overlap( this.player, this.monnaie,  this.prendreMonnaie, null,this);


            //vie interface
            this.coeurEcran = this.add.image(306, 161,'8HP').setScale(0.7)
            this.coeurEcran.setInteractive()
            this.coeurEcran.setScrollFactor(0);  

            this.coeurEcran.setDepth(9)

            // monnaie interface
            this.monnaieEcran = this.add.image(275, 185,'monnaieInterface').setScale(0.5);
            this.monnaieEcran.setDepth(100)
            this.monnaieEcran.setScrollFactor(0);  
            this.monnaieTexte = this.add.text(288, 174,this.solde, {
                font: '30px Poppins semibold',
                fill: "#0022BD" 
            });
            this.monnaieTexte.setDepth(100)
            this.monnaieTexte.setScale(0.7);
            this.monnaieTexte.setScrollFactor(0);

            ///////////////////////////////////////////////////////////////
            //////////////////////////////PNJ//////////////////////////////
            ///////////////////////////////////////////////////////////////

            this.pnj = this.physics.add.image(2000,1275, 'pnj1');
            this.pnj.setPushable(false)
            this.pnj.body.setSize(48,70)
            this.pnj.setOffset(-8,0)
            this.pnj.setDepth(8)
            this.physics.add.overlap(this.player,this.pnj,this.parlerPNJ,null,this);

            ///////////////////////////////////////////////////////////////
            /////////////////////////TOUCHES///////////////////////////////
            ///////////////////////////////////////////////////////////////

            this.cursors = this.input.keyboard.createCursorKeys();
            this.keys = this.input.keyboard.addKeys({
                q:  this.input.keyboard.addKey('Q'),
                d:  this.input.keyboard.addKey('D'),
                z:  this.input.keyboard.addKey('Z'),
                s:  this.input.keyboard.addKey('S'),
            });

            this.toucheF = this.input.keyboard.addKey('F');
            this.toucheG = this.input.keyboard.addKey('G');
            this.trancher = this.input.keyboard.addKey('A');
        }

        update(){
            if (this.dialogue == false){
                this.moveUp = ( this.cursors.up.isDown || this.keys.z.isDown )  
                this.moveLeft = ( this.cursors.left.isDown || this.keys.q.isDown )  
                this.moveRight = ( this.cursors.right.isDown || this.keys.d.isDown ) 
                this.moveDown = ( this.cursors.down.isDown || this.keys.s.isDown ) 
                

                const speed = 100

                    if (this.moveLeft) {
                        this.player.setVelocityX(-speed)
                        this.player.direction = 'left';
                    } else if (this.moveRight) {
                        this.player.setVelocityX(speed)
                        this.player.direction = 'right';
                    }

                    if (this.moveUp) {
                        this.player.setVelocityY(-speed)
                        this.player.direction = 'up';
                    } else if (this.moveDown) {
                        this.player.setVelocityY(speed)
                        this.player.direction = 'down';
                    }

                    this.player.body.velocity.normalize().scale(speed)

                    if (this.moveUp) {
                        this.player.anims.play('back', true)
                    } else if (this.moveDown) {
                        this.player.anims.play('front', true)
                    } else
                    if (this.moveLeft) {
                        this.player.anims.play('left', true)
                    } else if (this.moveRight) {
                        this.player.anims.play('right', true)
                    }   

                    if (this.cursors.up.isUp && this.cursors.down.isUp && this.cursors.left.isUp && this.cursors.right.isUp){
                        this.player.anims.play('noMove', true);
                        this.player.setVelocityX(0)
                        this.player.setVelocityY(0)
                    }
            }

             //sabre interface
            if (this.sabreInterface == true){
                this.sabreEcran = this.add.image(390, 162,'sabreInterface').setScale(0.4)
                this.sabreEcran.setInteractive()
                this.sabreEcran.setScrollFactor(0);  
                this.sabreEcran.setDepth(8)
            }

            //carte magnétique interface
            if (this.carteMagnetiqueInterface == true){
                this.carteMagnetiqueEcran = this.add.image(368, 162,'carteMagnetiqueInterface').setScale(0.4)
                this.carteMagnetiqueEcran.setInteractive()
                this.carteMagnetiqueEcran.setScrollFactor(0);  
                this.carteMagnetiqueEcran.setDepth(8)
            }

            // affichage background réacteurs sur l'interface
            if (this.reacteursBackgroundInterface == true){
                this.reacteursEcranBackground = this.add.image(476, 170,'reacteursInterfaces').setScale(0.5)
                this.reacteursEcranBackground.setScrollFactor(0);  
                this.reacteursEcranBackground.setDepth(10)
            }
            // réacteur 1 interface
            if (this.reacteur1Pris == true){
                this.reacteur1Ecran = this.add.image(464, 174,'réacteur1').setScale(0.4)
                this.reacteur1Ecran.setScrollFactor(0);  
                this.reacteur1Ecran.setDepth(10)
            }
            // réacteur 2 interface
            if (this.reacteur2Pris == true){
                this.reacteur1Ecran = this.add.image(488, 174,'réacteur2').setScale(0.4)
                this.reacteur1Ecran.setScrollFactor(0);  
                this.reacteur1Ecran.setDepth(10)
            }

                this.barreDeVie()
            }

            parlerPNJ(player,pnj){
            if (this.reacteur1Pris == false){
                if (Phaser.Input.Keyboard.JustDown(this.toucheF)) { 
                    this.dialogue = true
                    this.texteAvantGrotte = this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"TexteAvantGrotte1").setScale(0.35)
                    this.texteAvantGrotte.setDepth(10)
                    this.texteAvantGrotte.setScrollFactor(0)
                    this.texteAvantGrotte.setInteractive()
                    this.deuxiemeDialogue = true
                }

                if (this.deuxiemeDialogue == true){
                    if (Phaser.Input.Keyboard.JustDown(this.toucheG)) {
                        this.texteAvantGrotte.setTexture('TexteAvantGrotte2') 
                        this.dernierDialogue = true
                        this.deuxiemeDialogue = false                
                    }
                }
                if (this.dernierDialogue == true){
                    if (Phaser.Input.Keyboard.JustDown(this.toucheG)) {
                        this.carteMagnetiqueInterface = true
                        this.texteAvantGrotte.destroy()
                        this.reacteursBackgroundInterface = true
                        this.dialogue = false
                    }
                }
            }
            else {
                if (Phaser.Input.Keyboard.JustDown(this.toucheF)) {
                    this.texteApresGrotte = this.add.image(this.cameras.main.width/2,this.cameras.main.height/2,"TexteAprèstGrotte").setScale(0.35)
                    this.texteApresGrotte.setDepth(10)
                    this.texteApresGrotte.setScrollFactor(0)
                    this.texteApresGrotte.setInteractive()
                    this.dialogue = true
                }
                if (Phaser.Input.Keyboard.JustDown(this.toucheG)) {
                    this.texteApresGrotte.destroy()
                    this.dialogue = false
                }
            }
            
        }
            
            barreDeVie (){
            if (this.pointDeVie == 4){
                this.coeurEcran.setTexture('4HP')
            }
            if (this.pointDeVie == 3){
                this.coeurEcran.setTexture('3HP')
            }
            if (this.pointDeVie == 2){
                this.coeurEcran.setTexture('2HP')
            }
            if (this.pointDeVie == 1){
                this.coeurEcran.setTexture('1HP')
            }
        }

        prendreMonnaie(player,monnaie){
            monnaie.destroy(); 
            this.solde += 1
            this.monnaieTexte.setText(this.solde)
        }

        goOut1stHouse(player,sortieMaisonLunaire){
            if (Phaser.Input.Keyboard.JustDown(this.toucheF)) { 
                this.scene.start("sceneJeu", {
                    pointDeVie:this.pointDeVie,
                    sabreInterface:this.sabreInterface,
                    dialogue:this.dialogue,
                    trancherActif:this.trancherActif,
                    pouvoirAttaquer:this.pouvoirAttaquer,
                    animVehicule:this.animVehicule,
                    quitterVheicule:this.quitterVheicule,
                    invulnérable:this.invulnérable,
                    tempsAvantRespawn:this.tempsAvantRespawn,
                    porteOuverte:this.porteOuverte,
                    entreeBatiment: true,
                    spawnXSortieScene:530, 
                    spawnYSortieScene:400,
                    carteMagnetiqueInterface: this.carteMagnetiqueInterface,
                    solde: this.solde,
                    reacteur1Pris: this.reacteur1Pris,
                    reacteur2Pris:this.reacteur2Pris,
                    reacteursBackgroundInterface: this.reacteursBackgroundInterface
                })
            }
        }
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////AUTRE SCENE///////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    class sceneMaisonBlanche extends Phaser.Scene{
            constructor(){
            super("sceneMaisonBlanche");
        }

        init(data){
            this.pointDeVie = data.pointDeVie,
            this.sabreInterface = data.sabreInterface,
            this.dialogue = data.dialogue,
            this.trancherActif = data.trancherActif,
            this.pouvoirAttaquer = data.pouvoirAttaquer,
            this.animVehicule = data.animVehicule,
            this.quitterVheicule = data.quitterVheicule,
            this.invulnérable = data.invulnérable,
            this.tempsAvantRespawn = data.tempsAvantRespawn
            this.porteOuverte = data.porteOuverte,
            this.entreeBatiment = data.entreeBatiment,
            this.carteMagnetiqueInterface = data.carteMagnetiqueInterface,
            this.solde = data.solde,
            this.reacteur1Pris = data.reacteur1Pris,
            this.reacteur2Pris = data.reacteur2Pris,
            this.reacteursBackgroundInterface = data.reacteursBackgroundInterface
        }

        preload(){
            this.load.image("Phaser_tuilesMaisonHerbe", "assets/interieur maison zone herbe.png");

            this.load.tilemapTiledJSON("carte2", "mapAutreScenes.json");  

            this.load.spritesheet('perso','assets/perso.png',
            { frameWidth: 32, frameHeight: 32 });

            this.load.image("sabreInterface", "assets/interface/sabreInterface.png");

            // emplacement Changement De Scene
            this.load.image("changementScene", "assets/objets/emplacementChangementDeScene/changementScene.png");

            this.load.image("monnaie", "assets/objets/monnaie.png");
            this.load.image("monnaieInterface", "assets/interface/monnaieInterface.png");

            // frame barre de vie
            this.load.image("4HP", "assets/interface/vie/coeurInterface4HP.png");
            this.load.image("3HP", "assets/interface/vie/coeurInterface3HP.png");
            this.load.image("2HP", "assets/interface/vie/coeurInterface2HP.png");
            this.load.image("1HP", "assets/interface/vie/coeurInterface1HP.png");
            this.load.image("0HP", "assets/interface/vie/coeurInterface0HP.png");

            // reacteurs
            this.load.image("réacteur1", "assets/objets/réacteur1.png");
            this.load.image("réacteur2", "assets/objets/réacteur2.png");
            this.load.image("reacteursInterfaces", "assets/interface/reacteursInterfaces.png");
        }

        create(){
            const carte2 = this.make.tilemap({ key: 'carte2' });

            // importer les TileSet 
            const tilesetMaisonHerbe = carte2.addTilesetImage(
                    "interieur maison zone herbe",
                    "Phaser_tuilesMaisonHerbe"
                    );

            const groundMaisonHerbe = carte2.createLayer(
                    "groundMaisonHerbe",
                    tilesetMaisonHerbe
                    );

            const buildMaisonHerbe = carte2.createLayer(
                    "buildMaisonHerbe",
                    tilesetMaisonHerbe
                    );

            this.sortieMaisonBlanche = this.physics.add.image(6176,270, 'changementScene');
            this.sortieMaisonBlanche.body.setSize(128,40,true)
            
            this.player = this.physics.add.sprite(6160,260,'perso');
            this.player.body.setSize(24,6,true)
            this.player.setOffset(4, 26)

            const persoDerriereMaisonHerbe = carte2.createLayer(
                    "persoDerriereMaisonHerbe",
                    tilesetMaisonHerbe
                    );

            this.physics.add.collider(this.player, buildMaisonHerbe);
            buildMaisonHerbe.setCollisionByProperty({ estSolide: true });

            // collision avec l'entrée de la grotte
            this.physics.add.overlap(this.player, this.sortieMaisonBlanche, this.goOutWhiteHouse, null, this)

            this.player.setCollideWorldBounds(true);

            this.cameras.main.zoom = 3
            this.cameras.main.startFollow(this.player); 
            this.physics.world.setBounds(0, 0, 6400, 1600);
            this.cameras.main.setBounds(0, 0, 6400, 1600);

            this.anims.create({
                key: 'left',
                frames: this.anims.generateFrameNumbers('perso', {start:18,end:23}),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'right',
                frames: this.anims.generateFrameNumbers('perso', {start:12,end:17}),
                frameRate: 8,
                repeat: -1
            });
            this.anims.create({
                key: 'front',
                frames: this.anims.generateFrameNumbers('perso', {start:0,end:5}),
                frameRate: 8,
                repeat: -1
            });

            this.anims.create({
                key: 'back',
                frames: this.anims.generateFrameNumbers('perso', {start:6,end:11}),
                frameRate: 8,
                repeat: -1
            });

            this.anims.create({
                key: 'noMove',
                frames: this.anims.generateFrameNumbers('perso', {start:24,end:31}),
                frameRate: 8,
                repeat: -1
            });

             // monnaie à récupérer
             this.monnaie = this.physics.add.group({
            });
                    
            carte2.getObjectLayer('monnaie').objects.forEach((monnaie) => {
            this.monnaie.create(monnaie.x, monnaie.y, 'monnaie').setScale(0.7).setOrigin(0);
            });

            this.physics.add.overlap( this.player, this.monnaie,  this.prendreMonnaie, null,this);


            //vie interface
            this.coeurEcran = this.add.image(306, 161,'8HP').setScale(0.7)
            this.coeurEcran.setInteractive()
            this.coeurEcran.setScrollFactor(0);  

            this.coeurEcran.setDepth(1000)

            // monnaie interface
            this.monnaieEcran = this.add.image(275, 185,'monnaieInterface').setScale(0.5);
            this.monnaieEcran.setDepth(100)
            this.monnaieEcran.setScrollFactor(0);  
            this.monnaieTexte = this.add.text(288, 174,this.solde, {
                font: '30px Poppins semibold',
                fill: "#0022BD" 
            });
            this.monnaieTexte.setDepth(100)
            this.monnaieTexte.setScale(0.7);
            this.monnaieTexte.setScrollFactor(0);

            ///////////////////////////////////////////////////////////////
            /////////////////////////TOUCHES///////////////////////////////
            ///////////////////////////////////////////////////////////////

            this.cursors = this.input.keyboard.createCursorKeys();
            this.keys = this.input.keyboard.addKeys({
                q:  this.input.keyboard.addKey('Q'),
                d:  this.input.keyboard.addKey('D'),
                z:  this.input.keyboard.addKey('Z'),
                s:  this.input.keyboard.addKey('S'),
            });

            this.toucheF = this.input.keyboard.addKey('F');
            this.toucheG = this.input.keyboard.addKey('G');
            this.trancher = this.input.keyboard.addKey('A');
        }

        update(){
                this.moveUp = ( this.cursors.up.isDown || this.keys.z.isDown )  
                this.moveLeft = ( this.cursors.left.isDown || this.keys.q.isDown )  
                this.moveRight = ( this.cursors.right.isDown || this.keys.d.isDown ) 
                this.moveDown = ( this.cursors.down.isDown || this.keys.s.isDown ) 
                

                const speed = 100

                    if (this.moveLeft) {
                        this.player.setVelocityX(-speed)
                        this.player.direction = 'left';
                    } else if (this.moveRight) {
                        this.player.setVelocityX(speed)
                        this.player.direction = 'right';
                    }

                    if (this.moveUp) {
                        this.player.setVelocityY(-speed)
                        this.player.direction = 'up';
                    } else if (this.moveDown) {
                        this.player.setVelocityY(speed)
                        this.player.direction = 'down';
                    }

                    this.player.body.velocity.normalize().scale(speed)

                    if (this.moveUp) {
                        this.player.anims.play('back', true)
                    } else if (this.moveDown) {
                        this.player.anims.play('front', true)
                    } else
                    if (this.moveLeft) {
                        this.player.anims.play('left', true)
                    } else if (this.moveRight) {
                        this.player.anims.play('right', true)
                    }   

                    if (this.cursors.up.isUp && this.cursors.down.isUp && this.cursors.left.isUp && this.cursors.right.isUp){
                        this.player.anims.play('noMove', true);
                        this.player.setVelocityX(0)
                        this.player.setVelocityY(0)
                    }

             //sabre interface
            if (this.sabreInterface == true){
                this.sabreEcran = this.add.image(390, 162,'sabreInterface').setScale(0.4)
                this.sabreEcran.setInteractive()
                this.sabreEcran.setScrollFactor(0);  
            }

            //carte magnétique interface
            if (this.carteMagnetiqueInterface == true){
                this.carteMagnetiqueEcran = this.add.image(368, 162,'carteMagnetiqueInterface').setScale(0.4)
                this.carteMagnetiqueEcran.setInteractive()
                this.carteMagnetiqueEcran.setScrollFactor(0);  
                this.carteMagnetiqueEcran.setDepth(10)
            }

            // affichage background réacteurs sur l'interface
            if (this.reacteursBackgroundInterface == true){
                this.reacteursEcranBackground = this.add.image(476, 170,'reacteursInterfaces').setScale(0.5)
                this.reacteursEcranBackground.setScrollFactor(0);  
                this.reacteursEcranBackground.setDepth(10)
            }
            // réacteur 1 interface
            if (this.reacteur1Pris == true){
                this.reacteur1Ecran = this.add.image(464, 174,'réacteur1').setScale(0.4)
                this.reacteur1Ecran.setScrollFactor(0);  
                this.reacteur1Ecran.setDepth(10)
            }
            // réacteur 2 interface
            if (this.reacteur2Pris == true){
                this.reacteur1Ecran = this.add.image(488, 174,'réacteur2').setScale(0.4)
                this.reacteur1Ecran.setScrollFactor(0);  
                this.reacteur1Ecran.setDepth(10)
            }

                this.barreDeVie()
            }
            
            barreDeVie (){
            if (this.pointDeVie == 4){
                this.coeurEcran.setTexture('4HP')
            }
            if (this.pointDeVie == 3){
                this.coeurEcran.setTexture('3HP')
            }
            if (this.pointDeVie == 2){
                this.coeurEcran.setTexture('2HP')
            }
            if (this.pointDeVie == 1){
                this.coeurEcran.setTexture('1HP')
            }
        }

        prendreMonnaie(player,monnaie){
            monnaie.destroy(); 
            this.solde += 1
            this.monnaieTexte.setText(this.solde)
        }

        goOutWhiteHouse(player,sortieMaisonBlanche){
            if (Phaser.Input.Keyboard.JustDown(this.toucheF)) { 
                this.scene.start("sceneJeu", {
                    pointDeVie:this.pointDeVie,
                    sabreInterface:this.sabreInterface,
                    dialogue:this.dialogue,
                    trancherActif:this.trancherActif,
                    pouvoirAttaquer:this.pouvoirAttaquer,
                    animVehicule:this.animVehicule,
                    quitterVheicule:this.quitterVheicule,
                    invulnérable:this.invulnérable,
                    tempsAvantRespawn:this.tempsAvantRespawn,
                    porteOuverte:this.porteOuverte,
                    entreeBatiment: true,
                    spawnXSortieScene:500, 
                    spawnYSortieScene:200,
                    carteMagnetiqueInterface: this.carteMagnetiqueInterface,
                    solde: this.solde,
                    reacteur1Pris: this.reacteur1Pris,
                    reacteur2Pris:this.reacteur2Pris,
                    reacteursBackgroundInterface: this.reacteursBackgroundInterface
                })
            }
        }
    }

        var config = {
            type: Phaser.AUTO,
            width: 768, height: 432,
            physics: {
            default: 'arcade',
            arcade: {
            gravity: { y: 0 },
            debug: true
            }},
            pixelArt:true,
            scene: [accueil,sceneJeu,sceneGrotte,sceneMaison1,sceneMaisonBlanche],
            input : {gamepad:true},
            };

        new Phaser.Game(config);  
          

        

    </script>
</body>
</html>